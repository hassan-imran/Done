<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Done!</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div id="top_header">
        <h1>Done!</h1>

        <div id="motto"></div>
    </div>

    <div id="tableWrapper">

        <p id="noRemind">You have no reminders</p>

        <table id="remindTable">
            <thead>
                <th>Reminder</th>
                <th>Time</th>
                <th>Message</th>
                <th colspan="2">Actions</th>
            </thead>
            <tbody></tbody>
        </table>

        <div id="add">
            <button onclick="addNew()">
                Set a task
            </button>
        </div>

    </div>



    <script src="script.js"></script>
    <script>

        function checkKey() {
            accountKey = localStorage.getItem("account");
            users = JSON.parse(localStorage.getItem("users"));
            if ((!accountKey) || (!users[accountKey])) {
                window.location.assign("401.html");
            }
        }
        checkKey();

        document.getElementById("motto").innerHTML = users[accountKey][0];

        var remindUser = [];

        function createRemindArray() {
            for (var i = 0; i < users.length; i++) {
                remindUser[i] = [];
            }
        }

        createRemindArray();

        function updateTable() {
            if (remindUser[accountKey].length > 0) {
                document.getElementById("remindTable").getElementsByTagName("tbody")[0].innerHTML = "";
                document.getElementById("noRemind").style.display = "none";
                for (var i = 0; i < remindUser[accountKey].length; i += 3) {
                    document.getElementById("remindTable").getElementsByTagName("tbody")[0].innerHTML += "<tr id='row" + i + "'><td>" + remindUser[accountKey][i] + "</td><td>" + remindUser[accountKey][i + 1] + "</td><td>" + remindUser[accountKey][i + 2] + "</td><td><button onclick='edit(" + i + ")'>Edit</button><button onclick='del(" + i + ")'>Delete</button></td></tr>";
                }
                document.getElementById("remindTable").style.display = "block";
            }
            else {
                document.getElementById("remindTable").style.display = "none";
                document.getElementById("noRemind").style.display = "block";
            }
        }

        updateTable();

        function addNew() {
            remindUser[accountKey].push("", "", "");
            updateTable();
        }

        function edit(a) {
            var rowNo = a / 3;
            document.getElementById("row" + rowNo).innerHTML = "<tr id='row" + rowNo + "'><td><input type='text' value='"+remindUser[accountKey][a]+"'></td><td><input type='time' value='" + remindUser[accountKey][a + 1] + "'></td><td><input type='text' value='" + remindUser[accountKey][a + 2] + "'></td><td><button onclick='updateRow(" + a + ")'>Update</button><button onclick='del(" + a + ")'>Delete</button></td></tr>";
        }

        function del(a) {
            remindUser[accountKey].splice(a,3);
            updateTable();
        }

        

    </script>
</body>

</html>